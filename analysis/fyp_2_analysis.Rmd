---
title: "fyp_2_analysis"
output: html_document
---
```{r}
library(rjson)
library(ggplot2)
library(tidyr)
library(dplyr)
library(lme4)
library(lmerTest)
```

#Read files:
```{r}
data_location = "../data/fyp_2_data/" 
files = list.files(path = data_location,pattern="data_subject_.*.json")
modular_data = vector()
polygon_data = vector()
hybrid_data = vector()
#data frame building
subject = vector()
prompt = vector()
correct_response = vector()
rt = vector()
response = vector()
condition = vector()
trial_index = vector()
score = vector()

j = 1
for (i in 1:length(files)) {
  path = paste(data_location,files[i],sep="")
  print(i)
  print(path)
  c = file(path, "r")
  l = readLines(c, -1L)
  close(c)
  these_data = lapply(X=l, fromJSON)
  if (these_data[1][[1]][[1]]$trial_type == "instructions") {
      this_condition = "modular"
      modular_data[length(modular_data) + 1] = these_data[1]
  } else {
    if (grepl("subtract",gsub(" ","",these_data[1][[1]][[1]]$instructions))) { 
        this_condition = "hybrid"
        hybrid_data[length(hybrid_data) + 1] = these_data[1]
    }
    else {
       this_condition = "polygon"
       polygon_data[length(polygon_data) + 1] = these_data[1]
    }
  }
  
  for (trial_i in 1:length(these_data[1][[1]])) {
    if(grepl("question",gsub(" ","",these_data[1][[1]][[trial_i]]$trial_type))) {
      subject[j] = i
      condition[j] = this_condition
      prompt[j] = these_data[1][[1]][[trial_i]]$question
      correct_response[j] = these_data[1][[1]][[trial_i]]$correct_response
      
      if (is.null(these_data[1][[1]][[trial_i]]$response)) {
        response[j] = NA
      }
      else {
        response[j] = these_data[1][[1]][[trial_i]]$response
      }
      
      if (!is.na(response[j]) && response[j] == correct_response[j]) {
        score[j] = 1
      } else {
        score[j] = 0        
      }
      rt[j] = these_data[1][[1]][[trial_i]]$rt
      trial_index[j] = trial_i
      
      j = j+1
    }
  }
}
```

Write data for scoring
----------------------------

```{r}
#DONE --exact answers, explanations not yet scored
#n=9 operation questions
#write.table(complete_data[(grepl("Whatis8",gsub(" ","",complete_data$question)) | grepl("Whatis4",gsub(" ","",complete_data$question)))& grepl("explaininwords",gsub(" ","",complete_data$question)) ,c(1,3,4,5,7)],"N9_operation_to_score.csv",sep=",")

#DONE --exact answers, explanations not yet scored
#n=9 generator questions
# write.table(complete_data[grepl("generatorunder",gsub(" ","",complete_data$question)) & (grepl("nonagon",gsub(" ","",complete_data$question)) | grepl("+<sub>9",gsub(" ","",complete_data$question)) ),c(1,3,4,5,7)],"N9_generator_to_score.csv",sep=",")

#DONE --exact answers, explanations not yet scored
#n=9 inverse with explanations
#write.table(complete_data[grepl("inverseof3",gsub(" ","",complete_data$question)) & (grepl("nonagon",gsub(" ","",complete_data$question)) | grepl("+<sub>9",gsub(" ","",complete_data$question)) ),c(1,4,5,7)],"N9_inverse_to_score.csv",sep=",")

#DONE --exact answers, explanations not yet scored
#generator T/F and A/S/N with explanations
#write.table(complete_data[grepl("explaininwords",gsub(" ","",complete_data$question)) & (grepl("Trueorfalse",gsub(" ","",complete_data$question)) | grepl("always,sometimes,ornever",gsub(" ","",complete_data$question))),c(1,4,5,7)],"TF_ASN_explained_to_score.csv",sep=",")

#DONE -- exact answers, explanations not yet scored
#n-1,n-x
#write.table(complete_data[grepl("formula",gsub(" ","",complete_data$question)),c(1,4,5,7)],"inverse_formula_to_score.csv",sep=",")
```

data frame building
------------------------
```{r}
complete_data = data.frame(subject=factor(subject),condition=condition,question=prompt,correct_response=correct_response,response=response,rt=rt,trial_index=trial_index,score=score) 

#Insert scored data
inverse_formula_scores = read.csv(paste(data_location,"inverse_formula_scored.csv",sep=""))
complete_data[inverse_formula_scores$row.names,]$score = inverse_formula_scores$score

TF_ASN_explained_scores = read.csv(paste(data_location,"TF_ASN_explained_scored.csv",sep=""))
complete_data[TF_ASN_explained_scores$row.names,]$score = TF_ASN_explained_scores$score

N9_operation_scores =read.csv(paste(data_location,"N9_operation_scored.csv",sep=""))
complete_data[N9_operation_scores$row.names,]$score = N9_operation_scores$score
N9_operation_scores[grepl("Whatis4",gsub(" ","",N9_operation_scores$question)),]$correct_response = 5
N9_operation_scores[grepl("Whatis8",gsub(" ","",N9_operation_scores$question)),]$correct_response = 3
complete_data[N9_operation_scores$row.names,]$correct_response = N9_operation_scores$correct_response #omitted because of answer explanation

N9_generator_scores = read.csv(paste(data_location,"N9_generator_scored.csv",sep=""))
complete_data[N9_generator_scores$row.names,]$score = N9_generator_scores$score

N9_inverse_scores =read.csv(paste(data_location,"N9_inverse_scored.csv",sep=""))
complete_data[N9_inverse_scores$row.names,]$score = N9_inverse_scores$score
complete_data[N9_inverse_scores$row.names,]$correct_response = 6 #omitted because of answer explanation

#Strict scoring -- Some questions have "partial credit" of 0.5 for almost correct answers
complete_data = complete_data %>% mutate(score_strict = floor(score)) %>% 
  mutate(polygon=grepl("polygon",condition),prompt=grepl("prompt",condition)) #Factors of condition


```


Statistics
---------------------
##Operation
train
```{r}
mod = lmer(score_strict ~ polygon  + (1|subject), data=complete_data[grepl("Remember,toperform",gsub(" ","",complete_data$question)),]) #Collapsing across prompt/non-prompt conditions because they are equivalent up to this point
summary(mod)

gmod = glmer(score_strict ~ polygon  + (1|subject), family="binomial", data=complete_data[grepl("Remember,toperform",gsub(" ","",complete_data$question)),]) #Collapsing across prompt/non-prompt conditions because they are equivalent up to this point
summary(gmod)

```

test
```{r}
mod = lmer(score_strict ~ polygon  + (1|subject), data=complete_data[!(grepl("identity",gsub(" ","",complete_data$question)) | grepl("inverse",gsub(" ","",complete_data$question)) | grepl("generator",gsub(" ","",complete_data$question))) & (grepl("nonagon",gsub(" ","",complete_data$question)) | grepl("+<sub>9",gsub(" ","",complete_data$question)) ),]) #Collapsing across prompt/non-prompt conditions because they are equivalent up to this point
summary(mod)

gmod = glmer(score_strict ~ polygon  + (1|subject), family="binomial", data=complete_data[!(grepl("identity",gsub(" ","",complete_data$question)) | grepl("inverse",gsub(" ","",complete_data$question)) | grepl("generator",gsub(" ","",complete_data$question))) & (grepl("nonagon",gsub(" ","",complete_data$question)) | grepl("+<sub>9",gsub(" ","",complete_data$question)) ),]) #Collapsing across prompt/non-prompt conditions because they are equivalent up to this point
summary(gmod)
```

The methods do not differ significantly for learning the operation.

##Inverses
Inverse train score model:
```{r}


aggregated_data = complete_data[grepl("Remember,theinverse",gsub(" ","",complete_data$question)),] %>% mutate(correct_response=gsub(" ","",correct_response)) %>% select(score_strict,condition,polygon,prompt,correct_response,subject) %>% spread(correct_response,score_strict) %>% mutate(score = `0`+`2`+`3`+`4`+`5`)
  
ggplot(aggregated_data,aes(condition,score,fill=condition)) +
    geom_boxplot() +
    theme_bw() +
    labs(x="Condition",y="Inverse Train Accuracy")

mod = lmer(score_strict ~ polygon  + (1|subject), data=complete_data[grepl("Remember,theinverse",gsub(" ","",complete_data$question)),]) #Collapsing across prompt/non-prompt conditions because they are equivalent up to this point
summary(mod)

mod = glmer(score_strict ~ polygon  + (1|subject), family="binomial", data=complete_data[grepl("Remember,theinverse",gsub(" ","",complete_data$question)),]) #Collapsing across prompt/non-prompt conditions because they are equivalent up to this point
summary(mod)

```

Is this effect driven by performance on the "inverse of 0" question? 
```{r}
ggplot(aggregated_data,aes(condition,`0`,fill=condition)) +
    geom_boxplot() +
    theme_bw() +
    labs(x="Condition",y="Inverse of 0 Train Accuracy")

mod0 = lm(score_strict ~ polygon, data=complete_data[grepl("Whatistheinverseof0",gsub(" ","",complete_data$question)),]) #Test only the results on the inverse of 0 question
summary(mod0)

aggregated_data = aggregated_data %>% mutate(score_non_zero = score - `0`)

ggplot(aggregated_data,aes(condition,score_non_zero,fill=condition)) +
    geom_boxplot() +
    theme_bw() +
    labs(x="Condition",y="Inverse of Non-zero Elements Train Accuracy")


modnz = lmer(score_strict ~ polygon  + (1|subject), data=complete_data[grepl("Remember,theinverse",gsub(" ","",complete_data$question)) & !grepl("Whatistheinverseof0",gsub(" ","",complete_data$question)) ,]) #Test results on the non-zero questions
summary(modnz)
gmodnz = glmer(score_strict ~ polygon  + (1|subject), family="binomial", data=complete_data[grepl("Remember,theinverse",gsub(" ","",complete_data$question)) & !grepl("Whatistheinverseof0",gsub(" ","",complete_data$question)) ,]) #Test results on the non-zero questions
summary(gmodnz)
```

The polygon group performed significantly better on the "inverse of 0" question, but the groups were not significantly different on the other two conditions.

Inverse test score model:
```{r}


aggregated_data = complete_data[grepl("Whatistheinverse",gsub(" ","",complete_data$question)) & !grepl("Remember,theinverse",gsub(" ","",complete_data$question)),] %>% mutate(correct_response=gsub(" ","",correct_response)) %>% select(score_strict,condition,polygon,prompt,correct_response,subject) %>% spread(correct_response,score_strict) %>% mutate(score = `4`+`7`)
  
ggplot(aggregated_data,aes(condition,score,fill=condition)) +
    geom_boxplot() +
    theme_bw() +
    labs(x="Condition",y="Inverse Test Accuracy")

mod = lmer(score_strict ~ polygon*prompt  + (1|subject), data=complete_data[grepl("Whatistheinverse",gsub(" ","",complete_data$question)) & !grepl("Remember,theinverse",gsub(" ","",complete_data$question)) ,])
summary(mod)

mod0 = lmer(score_strict ~ polygon  + (1|subject), data=complete_data[grepl("Whatistheinverse",gsub(" ","",complete_data$question)) & !grepl("Remember,theinverse",gsub(" ","",complete_data$question)) ,])
summary(mod0)

anova(mod0,mod)


gmod = glmer(score_strict ~ polygon*prompt  + (1|subject), family="binomial", data=complete_data[grepl("Whatistheinverse",gsub(" ","",complete_data$question)) & !grepl("Remember,theinverse",gsub(" ","",complete_data$question)) ,])
summary(gmod)

gmod0 = glmer(score_strict ~ polygon  + (1|subject),family="binomial", data=complete_data[grepl("Whatistheinverse",gsub(" ","",complete_data$question)) & !grepl("Remember,theinverse",gsub(" ","",complete_data$question)) ,])
summary(gmod0)

anova(gmod0,gmod)

```

The difference went in the opposite direction in the test case, where we unfortunately did not ask about the inverse of 0 when n=9.
  
Inverse of 1, inverse of x questions
```{r}
ggplot(complete_data[inverse_formula_scores$row.names,],aes(condition,score_strict,fill=condition)) +
    geom_boxplot() +
    theme_bw() +
    labs(x="Condition",y="Accuracy")

# aggregated_data = complete_data[inverse_formula_scores$row.names,] %>% mutate(x_question = ifelse(grepl("x",correct_response),"x","one")) %>% select(score_strict,polygon,prompt,x_question,subject) %>% spread(x_question,score_strict) %>% mutate(score_strict = (one + x)/2)
#mod = lm(score_strict ~ polygon * prompt, data=aggregated_data)
#summary(mod)

#Model -- Just a nicer way of  doing the above model
mod_strict = lmer(score_strict ~ polygon * prompt + (1|subject), data=complete_data[inverse_formula_scores$row.names,])
summary(mod_strict)
mod_strict0.5 = lmer(score_strict ~ polygon + prompt + (1|subject), data=complete_data[inverse_formula_scores$row.names,])
summary(mod_strict0.5)
mod_strict0 = lmer(score_strict ~ polygon +(1|subject), data=complete_data[inverse_formula_scores$row.names,])
summary(mod_strict0)
anova(mod_strict0,mod_strict0.5,mod_strict)
anova(mod_strict0,mod_strict)

gmod_strict = glmer(score_strict ~ polygon * prompt + (1|subject), family="binomial",data=complete_data[inverse_formula_scores$row.names,])
summary(gmod_strict)
gmod_strict0 = glmer(score_strict ~ polygon +(1|subject),family="binomial", data=complete_data[inverse_formula_scores$row.names,])
summary(gmod_strict0)
anova(gmod_strict0,gmod_strict)
```

Does it make a difference using the non-strict score? (Including half credit for answers that made small errors like flipping a sign, "x-n" instead of "n-x", etc.)
```{r}
ggplot(complete_data[inverse_formula_scores$row.names,],aes(condition,score,fill=condition)) +
    geom_boxplot() +
    theme_bw() +
    labs(x="Condition",y="Score w/ Partial Credit")

mod_partial_credit = lmer(score ~ polygon * prompt + (1|subject), data=complete_data[inverse_formula_scores$row.names,])
summary(mod_partial_credit)
```

##Generators

Training (Order 6):
```{r}
ggplot(complete_data[grepl("generatorunder",gsub(" ","",complete_data$question)) & (grepl("hexagon",gsub(" ","",complete_data$question)) | grepl("+<sub>6",gsub(" ","",complete_data$question)) ),],aes(condition,score_strict,fill=condition)) +
    geom_boxplot() +
    theme_bw() +
    labs(x="Condition",y="Generator Training Accuracy")

mod = lmer(score_strict ~ polygon * prompt + (1|subject), data=complete_data[grepl("generatorunder",gsub(" ","",complete_data$question)) & (grepl("hexagon",gsub(" ","",complete_data$question)) | grepl("+<sub>9",gsub(" ","",complete_data$question)) ),])
summary(mod)
mod0.5 = lmer(score_strict ~ polygon + prompt + (1|subject), data=complete_data[grepl("generatorunder",gsub(" ","",complete_data$question)) & (grepl("hexagon",gsub(" ","",complete_data$question)) | grepl("+<sub>9",gsub(" ","",complete_data$question)) ),])
summary(mod0.5)
mod0 = lmer(score_strict ~ polygon + (1|subject), data=complete_data[grepl("generatorunder",gsub(" ","",complete_data$question)) & (grepl("hexagon",gsub(" ","",complete_data$question)) | grepl("+<sub>9",gsub(" ","",complete_data$question)) ),])
summary(mod0)
anova(mod0,mod0.5,mod)

temp_data = complete_data[grepl("generatorunder",gsub(" ","",complete_data$question)) & (grepl("hexagon",gsub(" ","",complete_data$question)) | grepl("+<sub>9",gsub(" ","",complete_data$question)) ),]
temp_data = temp_data %>% mutate(generator = (gsub(" ","",correct_response)) == "Yes")

mod0a = glmer(score_strict ~ polygon +  (1|subject),family="binomial", data=temp_data)
mod0.5a = glmer(score_strict ~ polygon + generator + (1|subject),family="binomial", data=temp_data)
summary(mod0a)
anova(mod0a,mod0.5a)
summary(mod0.5a)
```


Testing (order 9):
```{r}
ggplot(complete_data[grepl("generatorunder",gsub(" ","",complete_data$question)) & (grepl("nonagon",gsub(" ","",complete_data$question)) | grepl("+<sub>9",gsub(" ","",complete_data$question)) ),],aes(condition,score_strict,fill=condition)) +
    geom_boxplot() +
    theme_bw() +
    labs(x="Condition",y="Generators order 9 Test Accuracy")

mod = lmer(score_strict ~ polygon * prompt + (1|subject), data=complete_data[grepl("generatorunder",gsub(" ","",complete_data$question)) & (grepl("nonagon",gsub(" ","",complete_data$question)) | grepl("+<sub>9",gsub(" ","",complete_data$question)) ),])
summary(mod)
```

More info: including the number as possible effect, exploring different models with and without prompt and prompt x polygon interaction
```{r}
temp_data = complete_data[grepl("generatorunder",gsub(" ","",complete_data$question)) & (grepl("nonagon",gsub(" ","",complete_data$question)) | grepl("+<sub>9",gsub(" ","",complete_data$question)) ),]
temp_data = temp_data %>% mutate(number=ifelse(grepl("2",temp_data$question),2,ifelse(grepl("3",temp_data$question),3,ifelse(grepl("5",temp_data$question),5,6)))) 
temp_data$number = factor(temp_data$number)
temp_data$subject = factor(temp_data$subject)


#Does the interactive model fit the data better than an additive model, or one with just the main effect of polygon group, and no prompt effect?
mod0 = glmer(score_strict ~ polygon + number+ (1|subject), data=temp_data,family=binomial)
mod1 = glmer(score_strict ~ polygon + prompt + number + (1|subject), data=temp_data,family=binomial)
mod2 = glmer(score_strict ~ polygon * prompt + number + (1|subject), data=temp_data,family=binomial)
anova(mod0,mod1,mod2)
#Could there be an interaction of number and group?
mod0.5 = glmer(score_strict ~ polygon * number+ (1|subject), data=temp_data,family=binomial)
anova(mod0,mod0.5)

summary(mod0)

#Would it be better to treat number as a random effect?
mod0a = glmer(score_strict ~ polygon + (1|number)+ (1|subject), data=temp_data,family=binomial)
AIC(mod0a,mod0) #No

#Is it just whether the number generates rather than which number it is?
temp_data = temp_data %>% mutate(generator=ifelse(number==2 | number==5,TRUE,FALSE))
mod0b = glmer(score_strict ~ polygon + generator+(1|subject), data=temp_data,family=binomial)
AIC(mod0b,mod0) #Yes, why didn't I try that first

summary(mod0b)

mod0c = glmer(score_strict ~ polygon *generator+(1|subject), data=temp_data,family=binomial)
summary(mod0c)
```

It appears that there is a significant positive effect of polygon condition on ability to correctly test whether something is a generator, and a highly significant negative effect of the element actually being a generator. Subjects show a strong bias toward saying that an element is not a generator when it is.

Order n T/F:
```{r}
ggplot(complete_data[grepl("Trueorfalse",gsub(" ","",complete_data$question)),],aes(condition,score_strict,fill=condition)) +
    geom_boxplot() +
    theme_bw() +
    labs(x="Condition",y="Generators order n T/F Accuracy")

mod = lmer(score_strict ~ polygon * prompt + (1|subject), data=complete_data[grepl("Trueorfalse",gsub(" ","",complete_data$question)),])
mod0.5 = lmer(score_strict ~ polygon + prompt + (1|subject), data=complete_data[grepl("Trueorfalse",gsub(" ","",complete_data$question)),])
mod0 = lmer(score_strict ~ polygon + (1|subject), data=complete_data[grepl("Trueorfalse",gsub(" ","",complete_data$question)),])
anova(mod0,mod0.5,mod)
summary(mod0)


gmod = glmer(score_strict ~ polygon * prompt + (1|subject),family="binomial", data=complete_data[grepl("Trueorfalse",gsub(" ","",complete_data$question)),])
gmod0.5 = glmer(score_strict ~ polygon + prompt + (1|subject),family="binomial", data=complete_data[grepl("Trueorfalse",gsub(" ","",complete_data$question)),])
gmod0 = glmer(score_strict ~ polygon + (1|subject),family="binomial", data=complete_data[grepl("Trueorfalse",gsub(" ","",complete_data$question)),])
anova(gmod0,gmod0.5,gmod)
summary(gmod0)
```

The polygon group was significantly worse at the order n T/F questions.

Order n A/S/N:
```{r}
ggplot(complete_data[grepl("always,sometimes,ornever",gsub(" ","",complete_data$question)),],aes(condition,score_strict,fill=condition)) +
    geom_boxplot() +
    theme_bw() +
    labs(x="Condition",y="Generators order n A/S/N Accuracy")

mod = lmer(score_strict ~ polygon * prompt + (1|subject), data=complete_data[grepl("always,sometimes,ornever",gsub(" ","",complete_data$question)),])
summary(mod)
mod0.5 = lmer(score_strict ~ polygon + prompt + (1|subject), data=complete_data[grepl("always,sometimes,ornever",gsub(" ","",complete_data$question)),])
summary(mod0.5)
mod0 = lmer(score_strict ~ polygon + (1|subject), data=complete_data[grepl("always,sometimes,ornever",gsub(" ","",complete_data$question)),])
summary(mod0)

gmod = glmer(score_strict ~ polygon * prompt + (1|subject),family="binomial", data=complete_data[grepl("always,sometimes,ornever",gsub(" ","",complete_data$question)),])
summary(gmod)
gmod0.5 = glmer(score_strict ~ polygon + prompt + (1|subject),family="binomial", data=complete_data[grepl("always,sometimes,ornever",gsub(" ","",complete_data$question)),])
summary(gmod0.5)
gmod0 = glmer(score_strict ~ polygon + (1|subject),family="binomial", data=complete_data[grepl("always,sometimes,ornever",gsub(" ","",complete_data$question)),])
summary(gmod0)
```


##RT

```{r}
complete_data$rt = complete_data$rt/1000 #convert from ms to s
```


```{r}
rt_mod = lmer(rt ~ polygon + (1|subject),data=complete_data)
summary(rt_mod)
```

No significant overall difference, but this is averaged across all questions, so there may be a larger effect in some problem types. Try just the operation training:

```{r}
rt_mod = lmer(rt ~ polygon + (1|subject),data=complete_data[grepl("Remember,toperform",gsub(" ","",complete_data$question)),])
summary(rt_mod)
```

Not significant

##Question by question

```{r}
polygon_question = vector()
modular_question = vector()
polygon_question_aggregate_scores = vector()
modular_question_aggregate_scores = vector()
for (subj_i in 1:100) {
  this_subj_data = complete_data[complete_data$subject == subj_i,]
  this_subj_polygon = this_subj_data[1,]$polygon
  index = 1
  prob_i = 1
  offset = 0
  while (prob_i <= length(this_subj_data$question)) {
    if (prob_i==(11+offset) && grepl("Remember,toperform",gsub(" ","",this_subj_data[prob_i,]$question)))   { #If subject had to repeat training
      prob_i = prob_i+10      
      offset = offset + 10
    } 
    if (prob_i == 16+offset && grepl("prompt",this_subj_data[prob_i,]$condition)) {
      prob_i = prob_i+1
      offset = offset + 1
    }
    if (prob_i == 20+offset && grepl("prompt",this_subj_data[prob_i,]$condition)) {
      prob_i = prob_i+1
      offset = offset + 1
    }
    if (prob_i == 58+offset){ #Skip background questions
      break
    }
    
    if (this_subj_polygon) {
      this_problem_score = this_subj_data[prob_i,]$score_strict
      if (is.na(polygon_question_aggregate_scores[index])) {
        polygon_question_aggregate_scores[index] = this_problem_score 
        polygon_question[index] = this_subj_data[prob_i,]$question
      }
      else {
        polygon_question_aggregate_scores[index] = polygon_question_aggregate_scores[index] + this_problem_score 
      }
    } 
    else {
      this_problem_score = this_subj_data[prob_i,]$score_strict
      if (is.na(modular_question_aggregate_scores[index])) {
        modular_question_aggregate_scores[index] = this_problem_score 
        modular_question[index] = this_subj_data[prob_i,]$question
      }
      else {
        modular_question_aggregate_scores[index] = modular_question_aggregate_scores[index] + this_problem_score 
      }
      
    }
    
    prob_i = prob_i+1
    index = index + 1
  }
}
```

```{r}
aggregate_score_data = data.frame(condition=c(rep('polygon',length(polygon_question_aggregate_scores)),rep('modular',length(modular_question_aggregate_scores))),score=c(polygon_question_aggregate_scores,modular_question_aggregate_scores),question_index=rep(1:length(polygon_question_aggregate_scores),2))

aggregate_score_data = aggregate_score_data %>% mutate(percent_correct = score/50)

ggplot(data=aggregate_score_data,aes(question_index,percent_correct,fill=condition)) +
  geom_bar(stat='identity',position='dodge',width=0.5) +
  theme_bw()
```


Lab Meeting Presentation Stuff
----------------------
```{r}
sem <- function(x) {sd(x, na.rm=TRUE) / sqrt(length(x))}
theme_set(theme_bw())
```

```{r}
complete_data = complete_data %>% mutate(condition=ifelse(polygon,"Polygon","Modular"))
```


Operation train:
```{r}
summarized_data = complete_data[grepl("Remember,toperform",gsub(" ","",complete_data$question)),] %>% group_by(subject) %>% summarize(percent_correct = mean(score_strict),condition=head(condition,n=1)) %>% group_by(condition) %>% summarize(percent_correct.mean = mean(percent_correct),percent_correct.sem = sem(percent_correct))

ggplot(data=summarized_data,aes(condition,percent_correct.mean,fill=condition)) +
  geom_bar(stat="identity") +
  geom_errorbar(aes(ymax=percent_correct.mean+percent_correct.sem,ymin=percent_correct.mean-percent_correct.sem)) +
  ggtitle("Operation Training Results")
```


Operation test:
```{r}
summarized_data = complete_data[!(grepl("identity",gsub(" ","",complete_data$question)) | grepl("inverse",gsub(" ","",complete_data$question)) | grepl("generator",gsub(" ","",complete_data$question))) & (grepl("nonagon",gsub(" ","",complete_data$question)) | grepl("+<sub>9",gsub(" ","",complete_data$question)) ),] %>% group_by(subject) %>% summarize(percent_correct = mean(score_strict),condition=head(condition,n=1)) %>% group_by(condition) %>% summarize(percent_correct.mean = mean(percent_correct),percent_correct.sem = sem(percent_correct))

ggplot(data=summarized_data,aes(condition,percent_correct.mean,fill=condition)) +
  geom_bar(stat="identity") +
  geom_errorbar(aes(ymax=percent_correct.mean+percent_correct.sem,ymin=percent_correct.mean-percent_correct.sem)) +
  ggtitle("Operation Testing Results")
```


Inverse train:
```{r}
summarized_data = complete_data[grepl("Remember,theinverse",gsub(" ","",complete_data$question)),] %>% group_by(subject,condition) %>% summarize(percent_correct = mean(score_strict)) %>% group_by(condition) %>% summarize(percent_correct.mean = mean(percent_correct),percent_correct.sem = sem(percent_correct))

ggplot(data=summarized_data,aes(condition,percent_correct.mean,fill=condition)) +
  geom_bar(stat="identity",position="dodge") +
  geom_errorbar(aes(ymax=percent_correct.mean+percent_correct.sem,ymin=percent_correct.mean-percent_correct.sem),position="dodge") +
  annotate("text",x=1.5,y=1.0,label='p = 0.0125',alpha=0.5)+
  ggtitle("Inverse Training Results")
```


Inverse test:
```{r}
summarized_data = complete_data[grepl("Whatistheinverse",gsub(" ","",complete_data$question)) & !grepl("Remember,theinverse",gsub(" ","",complete_data$question)),] %>% group_by(subject,condition,prompt) %>% summarize(percent_correct = mean(score_strict)) %>% group_by(condition,prompt) %>% summarize(percent_correct.mean = mean(percent_correct),percent_correct.sem = sem(percent_correct))

ggplot(data=summarized_data,aes(condition,percent_correct.mean,fill=prompt)) +
  geom_bar(stat="identity",position="dodge") +
  geom_errorbar(aes(ymax=percent_correct.mean+percent_correct.sem,ymin=percent_correct.mean-percent_correct.sem),position="dodge") +
  annotate("text",x=1.5,y=1.0,label='mod vs. poly, p = 0.0487',alpha=0.5)+
  ggtitle("Inverse Testing Results")
```


Inverse of 0:
```{r}
summarized_data = complete_data[grepl("Remember,theinverse",gsub(" ","",complete_data$question)),] %>% filter(grepl("0",correct_response)) %>% group_by(subject,condition) %>% summarize(percent_correct = mean(score_strict)) %>% group_by(condition) %>% summarize(percent_correct.mean = mean(percent_correct),percent_correct.sem = sem(percent_correct))

ggplot(data=summarized_data,aes(condition,percent_correct.mean,fill=condition)) +
  geom_bar(stat="identity",position="dodge") +
  geom_errorbar(aes(ymax=percent_correct.mean+percent_correct.sem,ymin=percent_correct.mean-percent_correct.sem),position="dodge") +
  annotate("text",x=1.5,y=1.0,label='p < 0.001',alpha=0.5)+
  ggtitle("Inverse of 0 Results")
```


Inverse of 1, x:

```{r}


summarized_data = complete_data[grepl("formula",gsub(" ","",complete_data$question)),] %>% group_by(subject,condition,prompt) %>% summarize(percent_correct = mean(score_strict)) %>% group_by(condition,prompt) %>% summarize(percent_correct.mean = mean(percent_correct),percent_correct.sem = sem(percent_correct))

ggplot(data=summarized_data,aes(condition,percent_correct.mean,fill=prompt)) +
  geom_bar(stat="identity",position="dodge") +
  geom_errorbar(aes(ymax=percent_correct.mean+percent_correct.sem,ymin=percent_correct.mean-percent_correct.sem),position="dodge") +
  annotate("text",x=1.5,y=1.0,label='log. reg.: all effects sig @ p < 0.001',alpha=0.5)+
  ggtitle("Inverse of 1,x Results")

```


Generator testing:

```{r}


summarized_data = complete_data[grepl("generatorunder",gsub(" ","",complete_data$question)) & (grepl("nonagon",gsub(" ","",complete_data$question)) | grepl("+<sub>9",gsub(" ","",complete_data$question)) ),] %>% mutate(number=ifelse(grepl("2",temp_data$question),2,ifelse(grepl("3",temp_data$question),3,ifelse(grepl("5",temp_data$question),5,6)))) %>% mutate(generator=ifelse(number==2 | number==5,TRUE,FALSE))%>% group_by(subject,condition,prompt,generator) %>% summarize(percent_correct = mean(score_strict)) %>% group_by(condition,generator) %>% summarize(percent_correct.mean = mean(percent_correct),percent_correct.sem = sem(percent_correct))

ggplot(data=summarized_data,aes(condition,percent_correct.mean,fill=generator)) +
  geom_bar(stat="identity",position="dodge") +
  geom_errorbar(aes(ymax=percent_correct.mean+percent_correct.sem,ymin=percent_correct.mean-percent_correct.sem),position="dodge") +
  annotate("text",x=1.5,y=1.0,label='log. reg.: condition p = 0.02, \n generator p < 0.001',alpha=0.5)+
  ggtitle("Generator Testing Results")
```

Generator training:

```{r}


summarized_data = complete_data[grepl("generatorunder",gsub(" ","",complete_data$question)) & (grepl("hexagon",gsub(" ","",complete_data$question)) | grepl("+<sub>6",gsub(" ","",complete_data$question)) ),] %>% mutate(generator = (gsub(" ","",correct_response)) == "Yes") %>% group_by(subject,condition,prompt,generator) %>% summarize(percent_correct = mean(score_strict)) %>% group_by(condition,generator) %>% summarize(percent_correct.mean = mean(percent_correct),percent_correct.sem = sem(percent_correct))

ggplot(data=summarized_data,aes(condition,percent_correct.mean,fill=generator)) +
  geom_bar(stat="identity",position="dodge") +
  geom_errorbar(aes(ymax=percent_correct.mean+percent_correct.sem,ymin=percent_correct.mean-percent_correct.sem),position="dodge") +
  annotate("text",x=1.5,y=1.0,label='log. reg.: main effects p < 0.01',alpha=0.5)+
  ggtitle("Generator Training Results")
```

Generator T/F:

```{r}
summarized_data = complete_data[grepl("Trueorfalse",gsub(" ","",complete_data$question)),] %>% group_by(subject,condition,prompt) %>% summarize(percent_correct = mean(score_strict)) %>% group_by(condition) %>% summarize(percent_correct.mean = mean(percent_correct),percent_correct.sem = sem(percent_correct))

ggplot(data=summarized_data,aes(condition,percent_correct.mean,fill=condition)) +
  geom_bar(stat="identity",position="dodge") +
  geom_errorbar(aes(ymax=percent_correct.mean+percent_correct.sem,ymin=percent_correct.mean-percent_correct.sem),position="dodge") +
  annotate("text",x=1.5,y=1.0,label='log. reg.: polygon worse, p < 0.05',alpha=0.5)+
  ggtitle("Generator T/F Results")
```

